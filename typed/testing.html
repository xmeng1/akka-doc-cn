<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Testing &bull; Akka Documentation 中文</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="akka-docs-cn"/>
<link rel="canonical" href="http://doc.akka.io/docs/akka/current/typed/testing.html"/>
<script type="text/javascript" src="../lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="../lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="../lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="../lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="../css/icons.css"/>
<link rel="stylesheet" type="text/css" href="../css/page.css"/>
<link rel="shortcut icon" href="../images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../images/favicon-16x16.png">
<link rel="manifest" href="../images/manifest.json">
<meta name="msapplication-TileImage" content="../images/mstile-150x150.png">
<meta name="msapplication-TileColor" content="#15a9ce">
<meta name="theme-color" content="#15a9ce">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<script type="text/plain" class="optanon-category-2">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
ga('tsTracker.require', 'linker');
ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
ga('tsTracker.send', 'pageview');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="http://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation 中文</a></h1>
</div>
<div class="nav-header-version">
Version 2.5-SNAPSHOT
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../index-actors.html" class="page">Actors</a></li>
  <li><a href="../typed/index.html" class="page">Akka Typed</a>
  <ul>
    <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
    <li><a href="../typed/actors.html" class="page">Actors</a></li>
    <li><a href="../typed/dispatchers.html" class="page">Dispatchers</a></li>
    <li><a href="../typed/coexisting.html" class="page">Coexistence</a></li>
    <li><a href="../typed/actor-lifecycle.html" class="page">Actor lifecycle</a></li>
    <li><a href="../typed/interaction-patterns.html" class="page">Interaction Patterns</a></li>
    <li><a href="../typed/fault-tolerance.html" class="page">Fault Tolerance</a></li>
    <li><a href="../typed/actor-discovery.html" class="page">Actor discovery</a></li>
    <li><a href="../typed/stash.html" class="page">Stash</a></li>
    <li><a href="../typed/stream.html" class="page">Streams</a></li>
    <li><a href="../typed/cluster.html" class="page">Cluster</a></li>
    <li><a href="../typed/distributed-data.html" class="page">Distributed Data</a></li>
    <li><a href="../typed/cluster-singleton.html" class="page">Cluster Singleton</a></li>
    <li><a href="../typed/cluster-sharding.html" class="page">Cluster Sharding</a></li>
    <li><a href="../typed/persistence.html" class="page">Persistence</a></li>
    <li><a href="../typed/fsm.html" class="page">Behaviors as Finite state machines</a></li>
    <li><a href="../typed/testing.html#testing" class="active page">Testing</a>
    <ul>
      <li><a href="../typed/testing.html#dependency" class="header">Dependency</a></li>
      <li><a href="../typed/testing.html#introduction" class="header">Introduction</a></li>
      <li><a href="../typed/testing.html#synchronous-behavior-testing" class="header">Synchronous behavior testing</a></li>
      <li><a href="../typed/testing.html#asynchronous-testing" class="header">Asynchronous testing</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../index-cluster.html" class="page">Clustering</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../index-network.html" class="page">Networking</a></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../index-futures.html" class="page">Futures and Agents</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../howto.html" class="page">HowTo: Common Patterns</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../additional/index.html" class="page">Additional Information</a></li>
  <li><a href="../chinese/index.html" class="page">中文版文档说明</a></li>
</ul>
</nav>
</div>
</header>

<aside class="show-for-large">
<header class="nav-header fixed-sidebar-header">
<div class="nav-header-title">
<h1><a href="../index.html">Akka Documentation 中文</a></h1>
</div>
<div class="nav-header-version">
Version 2.5-SNAPSHOT
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="site-nav fixed-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="../security/index.html" class="page">Security Announcements</a></li>
  <li><a href="../guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="../general/index.html" class="page">General Concepts</a></li>
  <li><a href="../index-actors.html" class="page">Actors</a></li>
  <li><a href="../typed/index.html" class="page">Akka Typed</a>
  <ul>
    <li><a href="../typed/guide/index.html" class="page">Getting Started Guide</a></li>
    <li><a href="../typed/actors.html" class="page">Actors</a></li>
    <li><a href="../typed/dispatchers.html" class="page">Dispatchers</a></li>
    <li><a href="../typed/coexisting.html" class="page">Coexistence</a></li>
    <li><a href="../typed/actor-lifecycle.html" class="page">Actor lifecycle</a></li>
    <li><a href="../typed/interaction-patterns.html" class="page">Interaction Patterns</a></li>
    <li><a href="../typed/fault-tolerance.html" class="page">Fault Tolerance</a></li>
    <li><a href="../typed/actor-discovery.html" class="page">Actor discovery</a></li>
    <li><a href="../typed/stash.html" class="page">Stash</a></li>
    <li><a href="../typed/stream.html" class="page">Streams</a></li>
    <li><a href="../typed/cluster.html" class="page">Cluster</a></li>
    <li><a href="../typed/distributed-data.html" class="page">Distributed Data</a></li>
    <li><a href="../typed/cluster-singleton.html" class="page">Cluster Singleton</a></li>
    <li><a href="../typed/cluster-sharding.html" class="page">Cluster Sharding</a></li>
    <li><a href="../typed/persistence.html" class="page">Persistence</a></li>
    <li><a href="../typed/fsm.html" class="page">Behaviors as Finite state machines</a></li>
    <li><a href="../typed/testing.html#testing" class="active page">Testing</a>
    <ul>
      <li><a href="../typed/testing.html#dependency" class="header">Dependency</a></li>
      <li><a href="../typed/testing.html#introduction" class="header">Introduction</a></li>
      <li><a href="../typed/testing.html#synchronous-behavior-testing" class="header">Synchronous behavior testing</a></li>
      <li><a href="../typed/testing.html#asynchronous-testing" class="header">Asynchronous testing</a></li>
    </ul></li>
  </ul></li>
  <li><a href="../index-cluster.html" class="page">Clustering</a></li>
  <li><a href="../stream/index.html" class="page">Streams</a></li>
  <li><a href="../index-network.html" class="page">Networking</a></li>
  <li><a href="../discovery/index.html" class="page">Discovery</a></li>
  <li><a href="../index-futures.html" class="page">Futures and Agents</a></li>
  <li><a href="../index-utilities.html" class="page">Utilities</a></li>
  <li><a href="../common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="../howto.html" class="page">HowTo: Common Patterns</a></li>
  <li><a href="../project/index.html" class="page">Project Information</a></li>
  <li><a href="../additional/index.html" class="page">Additional Information</a></li>
  <li><a href="../chinese/index.html" class="page">中文版文档说明</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer fixed-sidebar-footer">
<a href="http://akka.io"><img class="logo" src="../images/akka-logo-reverse.svg"></a>

</footer>
</aside>

<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">

<article class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#testing" name="testing" class="anchor"><span class="anchor-link"></span></a>Testing</h1>
<h2><a href="#dependency" name="dependency" class="anchor"><span class="anchor-link"></span></a>Dependency</h2>
<p>To use Akka TestKit Typed, add the module to your project:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "com.typesafe.akka" %% "akka-actor-testkit-typed" % "2.5-SNAPSHOT" % Test</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-actor-testkit-typed_2.12&lt;/artifactId&gt;
  &lt;version&gt;2.5-SNAPSHOT&lt;/version&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  test group: 'com.typesafe.akka', name: 'akka-actor-testkit-typed_2.12', version: '2.5-SNAPSHOT'
}</code></pre></dd></dl>
<h2><a href="#introduction" name="introduction" class="anchor"><span class="anchor-link"></span></a>Introduction</h2>
<p>Testing can either be done asynchronously using a real <code>ActorSystem</code> or synchronously on the testing thread using the <code>BehaviousTestKit</code>.</p>
<p>For testing logic in a <code>Behavior</code> in isolation synchronous testing is preferred. For testing interactions between multiple actors a more realistic asynchronous test is preferred.</p>
<p>Certain <code>Behavior</code>s will be hard to test synchronously e.g. if they spawn Future&rsquo;s and you rely on a callback to complete before observing the effect you want to test. Further support for controlling the scheduler and execution context used will be added.</p><div class="callout warning "><div class="callout-title">Warning</div>
<p>This module is currently marked as <a href="../common/may-change.html">may change</a> in the sense  of being the subject of final development. This means that API or semantics can  change without warning or deprecation period and it is not recommended to use  this module in production just yet.</p></div>
<h2><a href="#synchronous-behavior-testing" name="synchronous-behavior-testing" class="anchor"><span class="anchor-link"></span></a>Synchronous behavior testing</h2>
<p>The following demonstrates how to test:</p>
<ul>
  <li>Spawning child actors</li>
  <li>Spawning child actors anonymously</li>
  <li>Sending a message either as a reply or to another actor</li>
  <li>Sending a message to a child actor</li>
</ul>
<p>The examples below require the following imports:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/SyncTestingExampleSpec.scala#L8-L14" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.actor.testkit.typed.CapturedLogEvent
import akka.actor.testkit.typed.Effect._
import akka.actor.testkit.typed.scaladsl.BehaviorTestKit
import akka.actor.testkit.typed.scaladsl.TestInbox
import akka.actor.typed._
import akka.actor.typed.scaladsl._
import akka.event.Logging</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/SyncTestingExampleTest.java#L8-L17" target="_blank" title="Go to snippet source"></a><code class="language-java">import akka.actor.testkit.typed.CapturedLogEvent;
import akka.actor.testkit.typed.javadsl.BehaviorTestKit;
import akka.actor.testkit.typed.javadsl.Effects;
import akka.actor.testkit.typed.javadsl.TestInbox;
import akka.actor.typed.*;
import akka.actor.typed.javadsl.*;
import akka.event.Logging;
import java.util.HashMap;
import java.util.List;
import java.util.Optional;</code></pre></dd>
</dl>
<p>Each of the tests are testing an actor that based on the message executes a different effect to be tested:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/SyncTestingExampleSpec.scala#L27-L57" target="_blank" title="Go to snippet source"></a><code class="language-scala">sealed trait Cmd
case object CreateAnonymousChild extends Cmd
case class CreateChild(childName: String) extends Cmd
case class SayHelloToChild(childName: String) extends Cmd
case object SayHelloToAnonymousChild extends Cmd
case class SayHello(who: ActorRef[String]) extends Cmd
case class LogAndSayHello(who: ActorRef[String]) extends Cmd

val myBehavior = Behaviors.receivePartial[Cmd] {
  case (context, CreateChild(name)) ⇒
    context.spawn(childActor, name)
    Behaviors.same
  case (context, CreateAnonymousChild) ⇒
    context.spawnAnonymous(childActor)
    Behaviors.same
  case (context, SayHelloToChild(childName)) ⇒
    val child: ActorRef[String] = context.spawn(childActor, childName)
    child ! &quot;hello&quot;
    Behaviors.same
  case (context, SayHelloToAnonymousChild) ⇒
    val child: ActorRef[String] = context.spawnAnonymous(childActor)
    child ! &quot;hello stranger&quot;
    Behaviors.same
  case (_, SayHello(who)) ⇒
    who ! &quot;hello&quot;
    Behaviors.same
  case (context, LogAndSayHello(who)) ⇒
    context.log.info(&quot;Saying hello to {}&quot;, who.path.name)
    who ! &quot;hello&quot;
    Behaviors.same
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/SyncTestingExampleTest.java#L31-L110" target="_blank" title="Go to snippet source"></a><code class="language-java">interface Command {}

public static class CreateAChild implements Command {
  private final String childName;

  public CreateAChild(String childName) {
    this.childName = childName;
  }
}

public static class CreateAnAnonymousChild implements Command {}

public static class SayHelloToChild implements Command {
  private final String childName;

  public SayHelloToChild(String childName) {
    this.childName = childName;
  }
}

public static class SayHelloToAnonymousChild implements Command {}

public static class SayHello implements Command {
  private final ActorRef&lt;String&gt; who;

  public SayHello(ActorRef&lt;String&gt; who) {
    this.who = who;
  }
}

public static class LogAndSayHello implements Command {
  private final ActorRef&lt;String&gt; who;

  public LogAndSayHello(ActorRef&lt;String&gt; who) {
    this.who = who;
  }
}

public static Behavior&lt;Command&gt; myBehavior =
    Behaviors.receive(Command.class)
        .onMessage(
            CreateAChild.class,
            (context, message) -&gt; {
              context.spawn(childActor, message.childName);
              return Behaviors.same();
            })
        .onMessage(
            CreateAnAnonymousChild.class,
            (context, message) -&gt; {
              context.spawnAnonymous(childActor);
              return Behaviors.same();
            })
        .onMessage(
            SayHelloToChild.class,
            (context, message) -&gt; {
              ActorRef&lt;String&gt; child = context.spawn(childActor, message.childName);
              child.tell(&quot;hello&quot;);
              return Behaviors.same();
            })
        .onMessage(
            SayHelloToAnonymousChild.class,
            (context, message) -&gt; {
              ActorRef&lt;String&gt; child = context.spawnAnonymous(childActor);
              child.tell(&quot;hello stranger&quot;);
              return Behaviors.same();
            })
        .onMessage(
            SayHello.class,
            (context, message) -&gt; {
              message.who.tell(&quot;hello&quot;);
              return Behaviors.same();
            })
        .onMessage(
            LogAndSayHello.class,
            (context, message) -&gt; {
              context.getLog().info(&quot;Saying hello to {}&quot;, message.who.path().name());
              message.who.tell(&quot;hello&quot;);
              return Behaviors.same();
            })
        .build();</code></pre></dd>
</dl>
<p>For creating a child actor a noop actor is created:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/SyncTestingExampleSpec.scala#L21-L23" target="_blank" title="Go to snippet source"></a><code class="language-scala">val childActor = Behaviors.receiveMessage[String] { _ ⇒
  Behaviors.same[String]
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/SyncTestingExampleTest.java#L26-L27" target="_blank" title="Go to snippet source"></a><code class="language-java">public static Behavior&lt;String&gt; childActor =
    Behaviors.receive((context, message) -&gt; Behaviors.same());</code></pre></dd>
</dl>
<p>All of the tests make use of the <code>BehaviorTestkit</code> to avoid the need for a real <code>ActorContext</code>. Some of the tests make use of the <code>TestInbox</code> which allows the creation of an <code>ActorRef</code> that can be used for synchronous testing, similar to the <code>TestProbe</code> used for asynchronous testing.</p>
<h3><a href="#spawning-children" name="spawning-children" class="anchor"><span class="anchor-link"></span></a>Spawning children</h3>
<p>With a name:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/SyncTestingExampleSpec.scala#L70-L72" target="_blank" title="Go to snippet source"></a><code class="language-scala">val testKit = BehaviorTestKit(myBehavior)
testKit.run(CreateChild(&quot;child&quot;))
testKit.expectEffect(Spawned(childActor, &quot;child&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/SyncTestingExampleTest.java#L116-L118" target="_blank" title="Go to snippet source"></a><code class="language-java">BehaviorTestKit&lt;Command&gt; test = BehaviorTestKit.create(myBehavior);
test.run(new CreateAChild(&quot;child&quot;));
test.expectEffect(Effects.spawned(childActor, &quot;child&quot;, Props.empty()));</code></pre></dd>
</dl>
<p>Anonymously:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/SyncTestingExampleSpec.scala#L78-L80" target="_blank" title="Go to snippet source"></a><code class="language-scala">val testKit = BehaviorTestKit(myBehavior)
testKit.run(CreateAnonymousChild)
testKit.expectEffect(SpawnedAnonymous(childActor))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/SyncTestingExampleTest.java#L125-L127" target="_blank" title="Go to snippet source"></a><code class="language-java">BehaviorTestKit&lt;Command&gt; test = BehaviorTestKit.create(myBehavior);
test.run(new CreateAnAnonymousChild());
test.expectEffect(Effects.spawnedAnonymous(childActor, Props.empty()));</code></pre></dd>
</dl>
<h3><a href="#sending-messages" name="sending-messages" class="anchor"><span class="anchor-link"></span></a>Sending messages</h3>
<p>For testing sending a message a <code>TestInbox</code> is created that provides an <code>ActorRef</code> and methods to assert against the messages that have been sent to it.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/SyncTestingExampleSpec.scala#L86-L89" target="_blank" title="Go to snippet source"></a><code class="language-scala">val testKit = BehaviorTestKit(myBehavior)
val inbox = TestInbox[String]()
testKit.run(SayHello(inbox.ref))
inbox.expectMessage(&quot;hello&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/SyncTestingExampleTest.java#L134-L137" target="_blank" title="Go to snippet source"></a><code class="language-java">BehaviorTestKit&lt;Command&gt; test = BehaviorTestKit.create(myBehavior);
TestInbox&lt;String&gt; inbox = TestInbox.create();
test.run(new SayHello(inbox.getRef()));
inbox.expectMessage(&quot;hello&quot;);</code></pre></dd>
</dl>
<p>Another use case is sending a message to a child actor you can do this by looking up the &lsquo;TestInbox&rsquo; for a child actor from the &lsquo;BehaviorTestKit&rsquo;:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/SyncTestingExampleSpec.scala#L95-L98" target="_blank" title="Go to snippet source"></a><code class="language-scala">val testKit = BehaviorTestKit(myBehavior)
testKit.run(SayHelloToChild(&quot;child&quot;))
val childInbox = testKit.childInbox[String](&quot;child&quot;)
childInbox.expectMessage(&quot;hello&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/SyncTestingExampleTest.java#L144-L147" target="_blank" title="Go to snippet source"></a><code class="language-java">BehaviorTestKit&lt;Command&gt; testKit = BehaviorTestKit.create(myBehavior);
testKit.run(new SayHelloToChild(&quot;child&quot;));
TestInbox&lt;String&gt; childInbox = testKit.childInbox(&quot;child&quot;);
childInbox.expectMessage(&quot;hello&quot;);</code></pre></dd>
</dl>
<p>For anonymous children the actor names are generated in a deterministic way:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/SyncTestingExampleSpec.scala#L104-L109" target="_blank" title="Go to snippet source"></a><code class="language-scala">val testKit = BehaviorTestKit(myBehavior)
testKit.run(SayHelloToAnonymousChild)
val child = testKit.expectEffectType[SpawnedAnonymous[String]]

val childInbox = testKit.childInbox(child.ref)
childInbox.expectMessage(&quot;hello stranger&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/SyncTestingExampleTest.java#L154-L158" target="_blank" title="Go to snippet source"></a><code class="language-java">BehaviorTestKit&lt;Command&gt; testKit = BehaviorTestKit.create(myBehavior);
testKit.run(new SayHelloToAnonymousChild());
// Anonymous actors are created as: $a $b etc
TestInbox&lt;String&gt; childInbox = testKit.childInbox(&quot;$a&quot;);
childInbox.expectMessage(&quot;hello stranger&quot;);</code></pre></dd>
</dl>
<h3><a href="#testing-other-effects" name="testing-other-effects" class="anchor"><span class="anchor-link"></span></a>Testing other effects</h3>
<p>The <code>BehaviorTestkit</code> keeps track other effects you can verify, look at the sub-classes of <code>akka.actor.testkit.typed.Effect</code></p>
<ul>
  <li>SpawnedAdapter</li>
  <li>Stopped</li>
  <li>Watched</li>
  <li>Unwatched</li>
  <li>Scheduled</li>
</ul>
<h3><a href="#checking-for-log-messages" name="checking-for-log-messages" class="anchor"><span class="anchor-link"></span></a>Checking for Log Messages</h3>
<p>The <code>BehaviorTestkit</code> also keeps track of everything that is being logged. Here, you can see an example on how to check if the behavior logged certain messages:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/SyncTestingExampleSpec.scala#L115-L119" target="_blank" title="Go to snippet source"></a><code class="language-scala">val testKit = BehaviorTestKit(myBehavior)
val inbox = TestInbox[String](&quot;Inboxer&quot;)
testKit.run(LogAndSayHello(inbox.ref))

testKit.logEntries() shouldBe Seq(CapturedLogEvent(Logging.InfoLevel, &quot;Saying hello to Inboxer&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/SyncTestingExampleTest.java#L165-L178" target="_blank" title="Go to snippet source"></a><code class="language-java">BehaviorTestKit&lt;Command&gt; test = BehaviorTestKit.create(myBehavior);
TestInbox&lt;String&gt; inbox = TestInbox.create(&quot;Inboxer&quot;);
test.run(new LogAndSayHello(inbox.getRef()));

List&lt;CapturedLogEvent&gt; allLogEntries = test.getAllLogEntries();
assertEquals(1, allLogEntries.size());
CapturedLogEvent expectedLogEvent =
    new CapturedLogEvent(
        Logging.InfoLevel(),
        &quot;Saying hello to Inboxer&quot;,
        Optional.empty(),
        Optional.empty(),
        new HashMap&lt;&gt;());
assertEquals(expectedLogEvent, allLogEntries.get(0));</code></pre></dd>
</dl>
<p>See the other public methods and API documentation on <code>BehaviorTestkit</code> for other types of verification.</p>
<h2><a href="#asynchronous-testing" name="asynchronous-testing" class="anchor"><span class="anchor-link"></span></a>Asynchronous testing</h2>
<p>Asynchronous testing uses a real <code>ActorSystem</code> that allows you to test your Actors in a more realistic environment.</p>
<p>The minimal setup consists of the test procedure, which provides the desired stimuli, the actor under test, and an actor receiving replies. Bigger systems replace the actor under test with a network of actors, apply stimuli at varying injection points and arrange results to be sent from different emission points, but the basic principle stays the same in that a single procedure drives the test.</p>
<h3><a href="#basic-example" name="basic-example" class="anchor"><span class="anchor-link"></span></a>Basic example</h3>
<p>Actor under test:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L24-L33" target="_blank" title="Go to snippet source"></a><code class="language-scala">case class Ping(message: String, response: ActorRef[Pong])
case class Pong(message: String)

val echoActor: Behavior[Ping] = Behaviors.receive { (_, message) ⇒
  message match {
    case Ping(m, replyTo) ⇒
      replyTo ! Pong(m)
      Behaviors.same
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L34-L70" target="_blank" title="Go to snippet source"></a><code class="language-java">public static class Ping {
  private String message;
  private ActorRef&lt;Pong&gt; replyTo;

  public Ping(String message, ActorRef&lt;Pong&gt; replyTo) {
    this.message = message;
    this.replyTo = replyTo;
  }
}

public static class Pong {
  private String message;

  public Pong(String message) {
    this.message = message;
  }

  @Override
  public boolean equals(Object o) {
    if (this == o) return true;
    if (!(o instanceof Pong)) return false;
    Pong pong = (Pong) o;
    return message.equals(pong.message);
  }

  @Override
  public int hashCode() {
    return Objects.hash(message);
  }
}

Behavior&lt;Ping&gt; echoActor =
    Behaviors.receive(
        (context, ping) -&gt; {
          ping.replyTo.tell(new Pong(ping.message));
          return Behaviors.same();
        });</code></pre></dd>
</dl>
<p>Tests create an instance of <code>ActorTestKit</code>. This provides access to:</p>
<ul>
  <li>An ActorSystem</li>
  <li>Methods for spawning Actors. These are created under the root guardian</li>
  <li>A method to shut down the ActorSystem from the test suite</li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L55-L56" target="_blank" title="Go to snippet source"></a><code class="language-scala">class AsyncTestingExampleSpec extends WordSpec with BeforeAndAfterAll with Matchers {
  val testKit = ActorTestKit()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L29-L30" target="_blank" title="Go to snippet source"></a><code class="language-java">public class AsyncTestingExampleTest extends JUnitSuite {
  static final ActorTestKit testKit = ActorTestKit.create();</code></pre></dd>
</dl>
<p>Your test is responsible for shutting down the <code>ActorSystem</code> e.g. using <span class="group-scala"><code>BeforeAndAfterAll</code> when using ScalaTest</span><span class="group-java"><code>@AfterClass</code> when using JUnit</span>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L125" target="_blank" title="Go to snippet source"></a><code class="language-scala">override def afterAll(): Unit = testKit.shutdownTestKit()</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L110-L113" target="_blank" title="Go to snippet source"></a><code class="language-java">@AfterClass
public static void cleanup() {
  testKit.shutdownTestKit();
}</code></pre></dd>
</dl>
<p>The following demonstrates:</p>
<ul>
  <li>Creating a typed actor from the <code>TestKit</code>&rsquo;s system using <code>spawn</code></li>
  <li>Creating a typed <code>TestProbe</code></li>
  <li>Verifying that the actor under test responds via the <code>TestProbe</code></li>
</ul>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L64-L67" target="_blank" title="Go to snippet source"></a><code class="language-scala">val pinger = testKit.spawn(echoActor, &quot;ping&quot;)
val probe = testKit.createTestProbe[Pong]()
pinger ! Ping(&quot;hello&quot;, probe.ref)
probe.expectMessage(Pong(&quot;hello&quot;))</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L119-L122" target="_blank" title="Go to snippet source"></a><code class="language-java">ActorRef&lt;Ping&gt; pinger = testKit.spawn(echoActor, &quot;ping&quot;);
TestProbe&lt;Pong&gt; probe = testKit.createTestProbe();
pinger.tell(new Ping(&quot;hello&quot;, probe.ref()));
probe.expectMessage(new Pong(&quot;hello&quot;));</code></pre></dd>
</dl>
<p>Actors can also be spawned anonymously:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L73" target="_blank" title="Go to snippet source"></a><code class="language-scala">val pinger = testKit.spawn(echoActor)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L129" target="_blank" title="Go to snippet source"></a><code class="language-java">ActorRef&lt;Ping&gt; pinger = testKit.spawn(echoActor);</code></pre></dd>
</dl>
<p>Note that you can add <code>import testKit._</code> to get access to the <code>spawn</code> and <code>createTestProbe</code> methods at the top level without prefixing them with <code>testKit</code>.</p>
<h4><a href="#stopping-actors" name="stopping-actors" class="anchor"><span class="anchor-link"></span></a>Stopping actors</h4>
<p>The method will wait until the actor stops or throw an assertion error in case of a timeout.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L84-L93" target="_blank" title="Go to snippet source"></a><code class="language-scala">val pinger1 = testKit.spawn(echoActor, &quot;pinger&quot;)
pinger1 ! Ping(&quot;hello&quot;, probe.ref)
probe.expectMessage(Pong(&quot;hello&quot;))
testKit.stop(pinger1) // Uses default timeout

// Immediately creating an actor with the same name
val pinger2 = testKit.spawn(echoActor, &quot;pinger&quot;)
pinger2 ! Ping(&quot;hello&quot;, probe.ref)
probe.expectMessage(Pong(&quot;hello&quot;))
testKit.stop(pinger2, 10.seconds) // Custom timeout</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L140-L149" target="_blank" title="Go to snippet source"></a><code class="language-java">ActorRef&lt;Ping&gt; pinger1 = testKit.spawn(echoActor, &quot;pinger&quot;);
pinger1.tell(new Ping(&quot;hello&quot;, probe.ref()));
probe.expectMessage(new Pong(&quot;hello&quot;));
testKit.stop(pinger1);

// Immediately creating an actor with the same name
ActorRef&lt;Ping&gt; pinger2 = testKit.spawn(echoActor, &quot;pinger&quot;);
pinger2.tell(new Ping(&quot;hello&quot;, probe.ref()));
probe.expectMessage(new Pong(&quot;hello&quot;));
testKit.stop(pinger2, Duration.ofSeconds(10));</code></pre></dd>
</dl>
<p>The <code>stop</code> method can only be used for actors that were spawned by the same <code>ActorTestKit</code>. Other actors will not be stopped by that method.</p>
<h3><a href="#observing-mocked-behavior" name="observing-mocked-behavior" class="anchor"><span class="anchor-link"></span></a>Observing mocked behavior</h3>
<p>When testing a component (which may be an actor or not) that interacts with other actors it can be useful to not have to run the other actors it depends on. Instead, you might want to create mock behaviors that accept and possibly respond to messages in the same way the other actor would do but without executing any actual logic. In addition to this it can also be useful to observe those interactions to assert that the component under test did send the expected messages. This allows the same kinds of tests as untyped <code>TestActor</code>/<code>Autopilot</code>.</p>
<p>As an example, let&rsquo;s assume we&rsquo;d like to test the following component:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L37-L49" target="_blank" title="Go to snippet source"></a><code class="language-scala">case class Message(i: Int, replyTo: ActorRef[Try[Int]])

class Producer(publisher: ActorRef[Message])(implicit scheduler: Scheduler) {

  def produce(messages: Int)(implicit timeout: Timeout): Unit = {
    (0 until messages).foreach(publish)
  }

  private def publish(i: Int)(implicit timeout: Timeout): Future[Try[Int]] = {
    publisher ? (ref ⇒ Message(i, ref))
  }

}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L74-L106" target="_blank" title="Go to snippet source"></a><code class="language-java"><br/>static class Message {
  int i;
  ActorRef&lt;Try&lt;Integer&gt;&gt; replyTo;

  Message(int i, ActorRef&lt;Try&lt;Integer&gt;&gt; replyTo) {
    this.i = i;
    this.replyTo = replyTo;
  }
}

public static class Producer {

  private Scheduler scheduler;
  private ActorRef&lt;Message&gt; publisher;

  Producer(Scheduler scheduler, ActorRef&lt;Message&gt; publisher) {
    this.scheduler = scheduler;
    this.publisher = publisher;
  }

  public void produce(int messages) {
    IntStream.range(0, messages).forEach(this::publish);
  }

  private CompletionStage&lt;Try&lt;Integer&gt;&gt; publish(int i) {
    return AskPattern.ask(
        publisher,
        (ActorRef&lt;Try&lt;Integer&gt;&gt; ref) -&gt; new Message(i, ref),
        Duration.ofSeconds(3),
        scheduler);
  }
}</code></pre></dd>
</dl>
<p>In our test, we create a mocked <code>publisher</code> actor. Additionally we use <code>Behaviors.monitor</code> with a <code>TestProbe</code> in order to be able to verify the interaction of the <code>producer</code> with the <code>publisher</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/AsyncTestingExampleSpec.scala#L100-L119" target="_blank" title="Go to snippet source"></a><code class="language-scala">import testKit._

// simulate the happy path
val mockedBehavior = Behaviors.receiveMessage[Message] { msg ⇒
  msg.replyTo ! Success(msg.i)
  Behaviors.same
}
val probe = testKit.createTestProbe[Message]()
val mockedPublisher = testKit.spawn(Behaviors.monitor(probe.ref, mockedBehavior))

// test our component
val producer = new Producer(mockedPublisher)
val messages = 3
producer.produce(messages)

// verify expected behavior
for (i ← 0 until messages) {
  val msg = probe.expectMessageType[Message]
  msg.i shouldBe i
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/AsyncTestingExampleTest.java#L156-L178" target="_blank" title="Go to snippet source"></a><code class="language-java">// simulate the happy path
Behavior&lt;Message&gt; mockedBehavior =
    Behaviors.receiveMessage(
        message -&gt; {
          message.replyTo.tell(new Success&lt;&gt;(message.i));
          return Behaviors.same();
        });
TestProbe&lt;Message&gt; probe = testKit.createTestProbe();
ActorRef&lt;Message&gt; mockedPublisher =
    testKit.spawn(Behaviors.monitor(probe.ref(), mockedBehavior));

// test our component
Producer producer = new Producer(testKit.scheduler(), mockedPublisher);
int messages = 3;
producer.produce(messages);

// verify expected behavior
IntStream.range(0, messages)
    .forEach(
        i -&gt; {
          Message msg = probe.expectMessageClass(Message.class);
          assertEquals(i, msg.i);
        });</code></pre></dd>
</dl>
<h3><a href="#test-framework-integration" name="test-framework-integration" class="anchor"><span class="anchor-link"></span></a>Test framework integration</h3><div class="group-java">
<p>If you are using JUnit you can use <code>akka.actor.testkit.typed.javadsl.TestKitJunitResource</code> to have the async test kit automatically shutdown when the test is complete.</p>
<p>Note that the dependency on JUnit is marked as optional from the test kit module, so your project must explicitly include a dependency on JUnit to use this.</p></div><div class="group-scala">
<p>If you are using ScalaTest you can extend <code>akka.actor.testkit.typed.scaladsl.ScalaTestWithActorTestKit</code> to have the async test kit automatically shutdown when the test is complete. This is done in <code>afterAll</code> from the <code>BeforeAndAfterAll</code> trait. If you override that method you should call <code>super.afterAll</code> to shutdown the test kit.</p>
<p>Note that the dependency on ScalaTest is marked as optional from the test kit module, so your project must explicitly include a dependency on ScalaTest to use this.</p></div>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/ScalaTestIntegrationExampleSpec.scala#L8-L19" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.actor.testkit.typed.scaladsl.ScalaTestWithActorTestKit
import org.scalatest.WordSpecLike

class ScalaTestIntegrationExampleSpec extends ScalaTestWithActorTestKit with WordSpecLike {

  &quot;Something&quot; must {
    &quot;behave correctly&quot; in {
      val probe = createTestProbe[String]()
      // ... assertions etc.
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/JunitIntegrationExampleTest.java#L8-L22" target="_blank" title="Go to snippet source"></a><code class="language-java">import akka.actor.testkit.typed.javadsl.TestKitJunitResource;
import akka.actor.testkit.typed.javadsl.TestProbe;
import org.junit.ClassRule;
import org.junit.Test;

public class JunitIntegrationExampleTest {

  @ClassRule public static final TestKitJunitResource testKit = new TestKitJunitResource();

  @Test
  public void testSomething() {
    TestProbe&lt;String&gt; probe = testKit.createTestProbe();
    // ... assertions etc.
  }
}</code></pre></dd>
</dl>
<h3><a href="#controlling-the-scheduler" name="controlling-the-scheduler" class="anchor"><span class="anchor-link"></span></a>Controlling the scheduler</h3>
<p>It can be hard to reliably unit test specific scenario&rsquo;s when your actor relies on timing: especially when running many tests in parallel it can be hard to get the timing just right. Making such tests more reliable by using generous timeouts make the tests take a long time to run.</p>
<p>For such situations, we provide a scheduler where you can manually, explicitly advance the clock.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/scala/docs/akka/actor/testkit/typed/scaladsl/ManualTimerExampleSpec.scala#L8-L109" target="_blank" title="Go to snippet source"></a><code class="language-scala">import scala.concurrent.duration._
import akka.actor.testkit.typed.scaladsl.ScalaTestWithActorTestKit
import akka.actor.testkit.typed.scaladsl.ManualTime
import akka.actor.testkit.typed.scaladsl.TestProbe
import akka.actor.typed.scaladsl.Behaviors
import org.scalatest.WordSpecLike

class ManualTimerExampleSpec extends ScalaTestWithActorTestKit(ManualTime.config) with WordSpecLike {

  val manualTime: ManualTime = ManualTime()

  &quot;A timer&quot; must {
    &quot;schedule non-repeated ticks&quot; in {
      case object Tick
      case object Tock

      val probe = TestProbe[Tock.type]()
      val behavior = Behaviors.withTimers[Tick.type] { timer ⇒
        timer.startSingleTimer(&quot;T&quot;, Tick, 10.millis)
        Behaviors.receiveMessage { _ ⇒
          probe.ref ! Tock
          Behaviors.same
        }
      }

      spawn(behavior)

      manualTime.expectNoMessageFor(9.millis, probe)

      manualTime.timePasses(2.millis)
      probe.expectMessage(Tock)

      manualTime.expectNoMessageFor(10.seconds, probe)
    }
  }
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-actor-testkit-typed/src/test/java/jdocs/akka/actor/testkit/typed/javadsl/ManualTimerExampleTest.java#L8-L56" target="_blank" title="Go to snippet source"></a><code class="language-java"><br/>import akka.actor.typed.Behavior;
import akka.actor.testkit.typed.javadsl.ManualTime;
import akka.actor.testkit.typed.javadsl.TestKitJunitResource;
import org.junit.ClassRule;
import org.scalatest.junit.JUnitSuite;
import java.time.Duration;

import akka.actor.typed.javadsl.Behaviors;

import org.junit.Test;

import akka.actor.testkit.typed.javadsl.TestProbe;

public class ManualTimerExampleTest extends JUnitSuite {

  @ClassRule
  public static final TestKitJunitResource testKit = new TestKitJunitResource(ManualTime.config());

  private final ManualTime manualTime = ManualTime.get(testKit.system());

  static final class Tick {}

  static final class Tock {}

  @Test
  public void testScheduleNonRepeatedTicks() {
    TestProbe&lt;Tock&gt; probe = testKit.createTestProbe();
    Behavior&lt;Tick&gt; behavior =
        Behaviors.withTimers(
            timer -&gt; {
              timer.startSingleTimer(&quot;T&quot;, new Tick(), Duration.ofMillis(10));
              return Behaviors.receive(
                  (context, tick) -&gt; {
                    probe.ref().tell(new Tock());
                    return Behaviors.same();
                  });
            });

    testKit.spawn(behavior);

    manualTime.expectNoMessageFor(Duration.ofMillis(9), probe);

    manualTime.timePasses(Duration.ofMillis(2));
    probe.expectMessageClass(Tock.class);

    manualTime.expectNoMessageFor(Duration.ofSeconds(10), probe);
  }
}</code></pre></dd>
</dl>
</div>
</article>

<div class="row">
<div class="small-12 large-9 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="../typed/fsm.html"><i class="icon-prev"></i> <span class="link-prev">Behaviors as Finite state machines</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="../index-cluster.html">Clustering <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>

<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/xmeng1/akka/tree/master/akka-docs-cn/src/main/paradox/typed/testing.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>


<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="../images/akka-icon.svg">
<section class="copyright">
<div>Akka is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2019 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> | 
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> | 
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> | 
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> | 
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> | 
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>
</footer>

</section>
</main>

<script type="text/javascript" src="../js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="../js/groups.js"></script>
<script type="text/javascript" src="../js/page.js"></script>
<script type="text/javascript" src="../js/magellan.js"></script>

<style type="text/css">@import "../lib/prettify/prettify.css";</style>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="../assets/js/warnOldDocs.js"></script>
<script type="text/javascript" src="../assets/js/scalafiddle.js"></script>


</body>
</html>
