<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>I/O &bull; Akka Documentation 中文</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="akka-docs-cn"/>
<link rel="canonical" href="http://doc.akka.io/docs/akka/current/io.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<link rel="manifest" href="images/manifest.json">
<meta name="msapplication-TileImage" content="images/mstile-150x150.png">
<meta name="msapplication-TileColor" content="#15a9ce">
<meta name="theme-color" content="#15a9ce">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<script type="text/plain" class="optanon-category-2">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
ga('tsTracker.require', 'linker');
ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
ga('tsTracker.send', 'pageview');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="http://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Documentation 中文</a></h1>
</div>
<div class="nav-header-version">
Version 2.5-SNAPSHOT
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="security/index.html" class="page">Security Announcements</a></li>
  <li><a href="guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="general/index.html" class="page">General Concepts</a></li>
  <li><a href="index-actors.html" class="page">Actors</a></li>
  <li><a href="typed/index.html" class="page">Akka Typed</a></li>
  <li><a href="index-cluster.html" class="page">Clustering</a></li>
  <li><a href="stream/index.html" class="page">Streams</a></li>
  <li><a href="index-network.html" class="page">Networking</a>
  <ul>
    <li><a href="remoting.html" class="page">Remoting</a></li>
    <li><a href="remoting-artery.html" class="page">Remoting (codename Artery)</a></li>
    <li><a href="serialization.html" class="page">Serialization</a></li>
    <li><a href="io.html#i-o" class="active page">I/O</a>
    <ul>
      <li><a href="io.html#dependency" class="header">Dependency</a></li>
      <li><a href="io.html#introduction" class="header">Introduction</a></li>
      <li><a href="io.html#terminology-concepts" class="header">Terminology, Concepts</a></li>
      <li><a href="io.html#architecture-in-depth" class="header">Architecture in-depth</a></li>
    </ul></li>
    <li><a href="io-tcp.html" class="page">Using TCP</a></li>
    <li><a href="io-udp.html" class="page">Using UDP</a></li>
    <li><a href="io-dns.html" class="page">DNS Extension</a></li>
    <li><a href="camel.html" class="page">Camel</a></li>
  </ul></li>
  <li><a href="discovery/index.html" class="page">Discovery</a></li>
  <li><a href="index-futures.html" class="page">Futures and Agents</a></li>
  <li><a href="index-utilities.html" class="page">Utilities</a></li>
  <li><a href="common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="howto.html" class="page">HowTo: Common Patterns</a></li>
  <li><a href="project/index.html" class="page">Project Information</a></li>
  <li><a href="additional/index.html" class="page">Additional Information</a></li>
  <li><a href="chinese/index.html" class="page">中文版文档说明</a></li>
</ul>
</nav>
</div>
</header>

<aside class="show-for-large">
<header class="nav-header fixed-sidebar-header">
<div class="nav-header-title">
<h1><a href="index.html">Akka Documentation 中文</a></h1>
</div>
<div class="nav-header-version">
Version 2.5-SNAPSHOT
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="site-nav fixed-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="security/index.html" class="page">Security Announcements</a></li>
  <li><a href="guide/index.html" class="page">Getting Started Guide</a></li>
  <li><a href="general/index.html" class="page">General Concepts</a></li>
  <li><a href="index-actors.html" class="page">Actors</a></li>
  <li><a href="typed/index.html" class="page">Akka Typed</a></li>
  <li><a href="index-cluster.html" class="page">Clustering</a></li>
  <li><a href="stream/index.html" class="page">Streams</a></li>
  <li><a href="index-network.html" class="page">Networking</a>
  <ul>
    <li><a href="remoting.html" class="page">Remoting</a></li>
    <li><a href="remoting-artery.html" class="page">Remoting (codename Artery)</a></li>
    <li><a href="serialization.html" class="page">Serialization</a></li>
    <li><a href="io.html#i-o" class="active page">I/O</a>
    <ul>
      <li><a href="io.html#dependency" class="header">Dependency</a></li>
      <li><a href="io.html#introduction" class="header">Introduction</a></li>
      <li><a href="io.html#terminology-concepts" class="header">Terminology, Concepts</a></li>
      <li><a href="io.html#architecture-in-depth" class="header">Architecture in-depth</a></li>
    </ul></li>
    <li><a href="io-tcp.html" class="page">Using TCP</a></li>
    <li><a href="io-udp.html" class="page">Using UDP</a></li>
    <li><a href="io-dns.html" class="page">DNS Extension</a></li>
    <li><a href="camel.html" class="page">Camel</a></li>
  </ul></li>
  <li><a href="discovery/index.html" class="page">Discovery</a></li>
  <li><a href="index-futures.html" class="page">Futures and Agents</a></li>
  <li><a href="index-utilities.html" class="page">Utilities</a></li>
  <li><a href="common/other-modules.html" class="page">Other Akka modules</a></li>
  <li><a href="howto.html" class="page">HowTo: Common Patterns</a></li>
  <li><a href="project/index.html" class="page">Project Information</a></li>
  <li><a href="additional/index.html" class="page">Additional Information</a></li>
  <li><a href="chinese/index.html" class="page">中文版文档说明</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer fixed-sidebar-footer">
<a href="http://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"></a>

</footer>
</aside>

<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">

<article class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#i-o" name="i-o" class="anchor"><span class="anchor-link"></span></a>I/O</h1>
<h2><a href="#dependency" name="dependency" class="anchor"><span class="anchor-link"></span></a>Dependency</h2>
<p>To use I/O, you must add the following dependency in your project:</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies += "com.typesafe.akka" %% "akka-actor" % "2.5-SNAPSHOT"</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.typesafe.akka&lt;/groupId&gt;
  &lt;artifactId&gt;akka-actor_2.12&lt;/artifactId&gt;
  &lt;version&gt;2.5-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'com.typesafe.akka', name: 'akka-actor_2.12', version: '2.5-SNAPSHOT'
}</code></pre></dd></dl>
<h2><a href="#introduction" name="introduction" class="anchor"><span class="anchor-link"></span></a>Introduction</h2>
<p>The <code>akka.io</code> package has been developed in collaboration between the Akka and <a href="http://spray.io">spray.io</a> teams. Its design combines experiences from the <code>spray-io</code> module with improvements that were jointly developed for more general consumption as an actor-based service.</p>
<p>The guiding design goal for this I/O implementation was to reach extreme scalability, make no compromises in providing an API correctly matching the underlying transport mechanism and to be fully event-driven, non-blocking and asynchronous. The API is meant to be a solid foundation for the implementation of network protocols and building higher abstractions; it is not meant to be a full-service high-level NIO wrapper for end users.</p>
<h2><a href="#terminology-concepts" name="terminology-concepts" class="anchor"><span class="anchor-link"></span></a>Terminology, Concepts</h2>
<p>The I/O API is completely actor based, meaning that all operations are implemented with message passing instead of direct method calls. Every I/O driver (TCP, UDP) has a special actor, called a <em>manager</em> that serves as an entry point for the API. I/O is broken into several drivers. The manager for a particular driver is accessible <span class="group-scala">through the <code>IO</code> entry point</span><span class="group-java">by querying an <code>ActorSystem</code></span>. For example the following code looks up the TCP manager and returns its <code>ActorRef</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/io/IODocSpec.scala#L19-L22" target="_blank" title="Go to snippet source"></a><code class="language-scala">import akka.io.{ IO, Tcp }
import context.system // implicitly used by IO(Tcp)

val manager = IO(Tcp)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/io/japi/EchoManager.java#L39" target="_blank" title="Go to snippet source"></a><code class="language-java">final ActorRef tcpManager = Tcp.get(getContext().getSystem()).manager();</code></pre></dd>
</dl>
<p>The manager receives I/O command messages and instantiates worker actors in response. The worker actors present themselves to the API user in the reply to the command that was sent. For example after a <code>Connect</code> command sent to the TCP manager the manager creates an actor representing the TCP connection. All operations related to the given TCP connections can be invoked by sending messages to the connection actor which announces itself by sending a <code>Connected</code> message.</p>
<h3><a href="#deathwatch-and-resource-management" name="deathwatch-and-resource-management" class="anchor"><span class="anchor-link"></span></a>DeathWatch and Resource Management</h3>
<p>I/O worker actors receive commands and also send out events. They usually need a user-side counterpart actor listening for these events (such events could be inbound connections, incoming bytes or acknowledgements for writes). These worker actors <em>watch</em> their listener counterparts. If the listener stops then the worker will automatically release any resources that it holds. This design makes the API more robust against resource leaks.</p>
<p>Thanks to the completely actor based approach of the I/O API the opposite direction works as well: a user actor responsible for handling a connection can watch the connection actor to be notified if it unexpectedly terminates.</p>
<h3><a href="#write-models-ack-nack-" name="write-models-ack-nack-" class="anchor"><span class="anchor-link"></span></a>Write models (Ack, Nack)</h3>
<p>I/O devices have a maximum throughput which limits the frequency and size of writes. When an application tries to push more data than a device can handle, the driver has to buffer bytes until the device is able to write them. With buffering it is possible to handle short bursts of intensive writes &mdash; but no buffer is infinite. &ldquo;Flow control&rdquo; is needed to avoid overwhelming device buffers.</p>
<p>Akka supports two types of flow control:</p>
<ul>
  <li><em>Ack-based</em>, where the driver notifies the writer when writes have succeeded.</li>
  <li><em>Nack-based</em>, where the driver notifies the writer when writes have failed.</li>
</ul>
<p>Each of these models is available in both the TCP and the UDP implementations of Akka I/O.</p>
<p>Individual writes can be acknowledged by providing an ack object in the write message (<code>Write</code> in the case of TCP and <code>Send</code> for UDP). When the write is complete the worker will send the ack object to the writing actor. This can be used to implement <em>ack-based</em> flow control; sending new data only when old data has been acknowledged.</p>
<p>If a write (or any other command) fails, the driver notifies the actor that sent the command with a special message (<code>CommandFailed</code> in the case of UDP and TCP). This message will also notify the writer of a failed write, serving as a nack for that write. Please note, that in a nack-based flow-control setting the writer has to be prepared for the fact that the failed write might not be the most recent write it sent. For example, the failure notification for a write <code>W1</code> might arrive after additional write commands <code>W2</code> and <code>W3</code> have been sent. If the writer wants to resend any nacked messages it may need to keep a buffer of pending messages.</p><div class="callout warning "><div class="callout-title">Warning</div>
<p>An acknowledged write does not mean acknowledged delivery or storage; receiving an ack for a write signals that the I/O driver has successfully processed the write. The Ack/Nack protocol described here is a means of flow control not error handling. In other words, data may still be lost, even if every write is acknowledged.</p></div>
<a id="bytestring"></a>
<h3><a href="#bytestring" name="bytestring" class="anchor"><span class="anchor-link"></span></a>ByteString</h3>
<p>To maintain isolation, actors should communicate with immutable objects only. <code>ByteString</code> is an immutable container for bytes. It is used by Akka&rsquo;s I/O system as an efficient, immutable alternative the traditional byte containers used for I/O on the JVM, such as <span class="group-scala"><code>Array[Byte]</code></span><span class="group-java"><code>byte[]</code></span> and <code>ByteBuffer</code>.</p>
<p><code>ByteString</code> is a <a href="http://en.wikipedia.org/wiki/Rope_(computer_science)">rope-like</a> data structure that is immutable and provides fast concatenation and slicing operations (perfect for I/O). When two <code>ByteString</code>s are concatenated together they are both stored within the resulting <code>ByteString</code> instead of copying both to a new <span class="group-scala"><code>Array</code></span><span class="group-java">array</span>. Operations such as <code>drop</code> and <code>take</code> return <code>ByteString</code>s that still reference the original <span class="group-scala"><code>Array</code></span><span class="group-java">array</span>, but just change the offset and length that is visible. Great care has also been taken to make sure that the internal <span class="group-scala"><code>Array</code></span><span class="group-java">array</span> cannot be modified. Whenever a potentially unsafe <span class="group-scala"><code>Array</code></span><span class="group-java">array</span> is used to create a new <code>ByteString</code> a defensive copy is created. If you require a <code>ByteString</code> that only blocks as much memory as necessary for it&rsquo;s content, use the <code>compact</code> method to get a <code>CompactByteString</code> instance. If the <code>ByteString</code> represented only a slice of the original array, this will result in copying all bytes in that slice.</p>
<p><code>ByteString</code> inherits all methods from <code>IndexedSeq</code>, and it also has some new ones. For more information, look up the <code>akka.util.ByteString</code> class and it&rsquo;s companion object in the ScalaDoc.</p>
<p><code>ByteString</code> also comes with its own optimized builder and iterator classes <code>ByteStringBuilder</code> and <code>ByteIterator</code> which provide extra features in addition to those of normal builders and iterators.</p>
<h4><a href="#compatibility-with-java-io" name="compatibility-with-java-io" class="anchor"><span class="anchor-link"></span></a>Compatibility with java.io</h4>
<p>A <code>ByteStringBuilder</code> can be wrapped in a <code>java.io.OutputStream</code> via the <code>asOutputStream</code> method. Likewise, <code>ByteIterator</code> can be wrapped in a <code>java.io.InputStream</code> via <code>asInputStream</code>. Using these, <code>akka.io</code> applications can integrate legacy code based on <code>java.io</code> streams.</p>
<h2><a href="#architecture-in-depth" name="architecture-in-depth" class="anchor"><span class="anchor-link"></span></a>Architecture in-depth</h2>
<p>For further details on the design and internal architecture see <a href="common/io-layer.html">I/O Layer Design</a>.</p>
</div>
</article>

<div class="row">
<div class="small-12 large-9 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
<a href="serialization.html"><i class="icon-prev"></i> <span class="link-prev">Serialization</span></a>
</div>
<div class="nav-next small-6 column clearfix">
<a class="float-right" href="io-tcp.html">Using TCP <i class="icon-next"></i></a>
</div>
</section>
</div>
</div>

<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/xmeng1/akka/tree/master/akka-docs-cn/src/main/paradox/io.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>


<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg">
<section class="copyright">
<div>Akka is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2019 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> | 
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> | 
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> | 
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> | 
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> | 
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>
</footer>

</section>
</main>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="assets/js/warnOldDocs.js"></script>
<script type="text/javascript" src="assets/js/scalafiddle.js"></script>


</body>
</html>
