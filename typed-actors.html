<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
<title>Typed Actors</title>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="description" content="akka-docs-cn"/>
<link rel="canonical" href="http://doc.akka.io/docs/akka/current/typed-actors.html"/>
<script type="text/javascript" src="lib/jquery/jquery.min.js"></script>
<script type="text/javascript" src="lib/foundation/dist/js/foundation.min.js"></script>
<link rel="stylesheet" type="text/css" href="lib/normalize.css/normalize.css"/>
<link rel="stylesheet" type="text/css" href="lib/foundation/dist/css/foundation.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" type="text/css" href="css/icons.css"/>
<link rel="stylesheet" type="text/css" href="css/page.css"/>
<link rel="shortcut icon" href="images/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<link rel="manifest" href="images/manifest.json">
<meta name="msapplication-TileImage" content="images/mstile-150x150.png">
<meta name="msapplication-TileColor" content="#15a9ce">
<meta name="theme-color" content="#15a9ce">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) start -->
<script src="https://optanon.blob.core.windows.net/consent/159bb13d-6748-4399-806e-ac28db879785.js" type="text/javascript" charset="UTF-8"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice (Production Standard, akka.io, en-GB) end -->
<!--Google Analytics-->
<script type="text/plain" class="optanon-category-2">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-21117439-1']);
_gaq.push(['_setDomainName', 'akka.io']);
_gaq.push(['_trackPageview']);
(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})()
</script>
<script type="text/plain" class="optanon-category-2">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-23127719-1', 'lightbend.com', {'allowLinker': true, 'name': 'tsTracker'});
ga('tsTracker.require', 'linker');
ga('tsTracker.linker:autoLink', ['lightbend.com','playframework.com','scala-lang.org','scaladays.org','spray.io','akka.io','scala-sbt.org','scala-ide.org']);
ga('tsTracker.send', 'pageview');
</script>
<!--Marketo-->
<script type="text/plain" class="optanon-category-3">
(function() {
var didInit = false;
function initMunchkin() {
if(didInit === false) {
didInit = true;
Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
}
}
var s = document.createElement('script');
s.type = 'text/javascript';
s.async = true;
s.src = '//munchkin.marketo.net/munchkin.js';
s.onreadystatechange = function() {
if (this.readyState == 'complete' || this.readyState == 'loaded') {
initMunchkin();
}
};
s.onload = initMunchkin;
document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
</head>

<body id="underlay" data-toggler="nav-open">

<header class="site-header hide-for-large">
<div class="sticky-header clearfix">
<a href="http://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"></a>

<button class="menu-icon float-right" type="button" data-toggle="underlay overlay"></button>
</div>
<div id="overlay" class="overlay-nav" data-toggler="nav-open">
<header class="nav-header">
<div class="nav-header-title">
<h1><a href="typed-actors.html">Typed Actors</a></h1>
</div>
<div class="nav-header-version">
Version 2.5-SNAPSHOT
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div id="overlay-search-container" class="nav-header-search">
<input id="overlay-search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="nav-toc">
<ul>
  <li><a href="typed-actors.html#when-to-use-typed-actors" class="header">When to use Typed Actors</a></li>
  <li><a href="typed-actors.html#the-tools-of-the-trade" class="header">The tools of the trade</a></li>
  <li><a href="typed-actors.html#creating-typed-actors" class="header">Creating Typed Actors</a></li>
  <li><a href="typed-actors.html#method-dispatch-semantics" class="header">Method dispatch semantics</a></li>
  <li><a href="typed-actors.html#messages-and-immutability" class="header">Messages and immutability</a></li>
  <li><a href="typed-actors.html#stopping-typed-actors" class="header">Stopping Typed Actors</a></li>
  <li><a href="typed-actors.html#typed-actor-hierarchies" class="header">Typed Actor Hierarchies</a></li>
  <li><a href="typed-actors.html#supervisor-strategy" class="header">Supervisor Strategy</a></li>
  <li><a href="typed-actors.html#lifecycle-callbacks" class="header">Lifecycle callbacks</a></li>
  <li><a href="typed-actors.html#receive-arbitrary-messages" class="header">Receive arbitrary messages</a></li>
  <li><a href="typed-actors.html#proxying" class="header">Proxying</a></li>
  <li><a href="typed-actors.html#lookup-remoting" class="header">Lookup &amp; Remoting</a></li>
  <li><a href="typed-actors.html#supercharging" class="header group-scala">Supercharging</a></li>
  <li><a href="typed-actors.html#typed-router-pattern" class="header">Typed Router pattern</a></li>
</ul>
</nav>
</div>
</header>

<aside class="show-for-large">
<header class="nav-header fixed-sidebar-header">
<div class="nav-header-title">
<h1><a href="typed-actors.html">Typed Actors</a></h1>
</div>
<div class="nav-header-version">
Version 2.5-SNAPSHOT
</div>
<div class="nav-header-groups">
<select class="supergroup" name="Language"><option class="group" value="group-scala">Scala</option><option class="group" value="group-java">Java</option></select>
</div>
<div class="nav-header-search">
<input id="search" type="search" class="search" placeholder="Search"/>
</div>
</header>
<nav class="site-nav fixed-sidebar-contents">
<div class="nav-toc">
<ul>
  <li><a href="typed-actors.html#when-to-use-typed-actors" class="header">When to use Typed Actors</a></li>
  <li><a href="typed-actors.html#the-tools-of-the-trade" class="header">The tools of the trade</a></li>
  <li><a href="typed-actors.html#creating-typed-actors" class="header">Creating Typed Actors</a></li>
  <li><a href="typed-actors.html#method-dispatch-semantics" class="header">Method dispatch semantics</a></li>
  <li><a href="typed-actors.html#messages-and-immutability" class="header">Messages and immutability</a></li>
  <li><a href="typed-actors.html#stopping-typed-actors" class="header">Stopping Typed Actors</a></li>
  <li><a href="typed-actors.html#typed-actor-hierarchies" class="header">Typed Actor Hierarchies</a></li>
  <li><a href="typed-actors.html#supervisor-strategy" class="header">Supervisor Strategy</a></li>
  <li><a href="typed-actors.html#lifecycle-callbacks" class="header">Lifecycle callbacks</a></li>
  <li><a href="typed-actors.html#receive-arbitrary-messages" class="header">Receive arbitrary messages</a></li>
  <li><a href="typed-actors.html#proxying" class="header">Proxying</a></li>
  <li><a href="typed-actors.html#lookup-remoting" class="header">Lookup &amp; Remoting</a></li>
  <li><a href="typed-actors.html#supercharging" class="header group-scala">Supercharging</a></li>
  <li><a href="typed-actors.html#typed-router-pattern" class="header">Typed Router pattern</a></li>
</ul>
</div>
</nav>
<footer class="nav-footer fixed-sidebar-footer">
<a href="http://akka.io"><img class="logo" src="images/akka-logo-reverse.svg"></a>

</footer>
</aside>

<main class="fixed-shift-for-large expanded row">
<section class="site-content small-12 column">

<article class="page-content row">
<div class="small-12 large-9 column" id="docs">
<h1><a href="#typed-actors" name="typed-actors" class="anchor"><span class="anchor-link"></span></a>Typed Actors</h1><div class="callout note "><div class="callout-title">Note</div>
<p>This module will be deprecated as it will be superseded by the <a href="typed/actors.html">Akka Typed</a> project which is currently being developed in open preview mode.</p></div>
<p>Akka Typed Actors is an implementation of the <a href="http://en.wikipedia.org/wiki/Active_object">Active Objects</a> pattern. Essentially turning method invocations into asynchronous dispatch instead of synchronous that has been the default way since Smalltalk came out.</p>
<p>Typed Actors consist of 2 &ldquo;parts&rdquo;, a public interface and an implementation, and if you&rsquo;ve done any work in &ldquo;enterprise&rdquo; Java, this will be very familiar to you. As with normal Actors you have an external API (the public interface instance) that will delegate method calls asynchronously to a private instance of the implementation.</p>
<p>The advantage of Typed Actors vs. Actors is that with TypedActors you have a static contract, and don&rsquo;t need to define your own messages, the downside is that it places some limitations on what you can do and what you can&rsquo;t, i.e. you cannot use <code>become</code>/<code>unbecome</code>.</p>
<p>Typed Actors are implemented using <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/reflect/Proxy.html">JDK Proxies</a> which provide a pretty easy-worked API to intercept method calls.</p><div class="callout note "><div class="callout-title">Note</div>
<p>Just as with regular Akka Actors, Typed Actors process one call at a time.</p></div>
<h2><a href="#when-to-use-typed-actors" name="when-to-use-typed-actors" class="anchor"><span class="anchor-link"></span></a>When to use Typed Actors</h2>
<p>Typed actors are nice for bridging between actor systems (the “inside”) and non-actor code (the “outside”), because they allow you to write normal OO-looking code on the outside. Think of them like doors: their practicality lies in interfacing between private sphere and the public, but you don’t want that many doors inside your house, do you? For a longer discussion see <a href="http://letitcrash.com/post/19074284309/when-to-use-typedactors">this blog post</a>.</p>
<p>A bit more background: TypedActors can easily be abused as RPC, and that is an abstraction which is <a href="http://doc.akka.io/docs/misc/smli_tr-94-29.pdf">well-known</a> to be leaky. Hence TypedActors are not what we think of first when we talk about making highly scalable concurrent software easier to write correctly. They have their niche, use them sparingly.</p>
<h2><a href="#the-tools-of-the-trade" name="the-tools-of-the-trade" class="anchor"><span class="anchor-link"></span></a>The tools of the trade</h2>
<p>Before we create our first Typed Actor we should first go through the tools that we have at our disposal, it&rsquo;s located in <code>akka.actor.TypedActor</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L88-L112" target="_blank" title="Go to snippet source"></a><code class="language-scala"><br/>import akka.actor.TypedActor

//Returns the Typed Actor Extension
val extension = TypedActor(system) //system is an instance of ActorSystem

//Returns whether the reference is a Typed Actor Proxy or not
TypedActor(system).isTypedActor(someReference)

//Returns the backing Akka Actor behind an external Typed Actor Proxy
TypedActor(system).getActorRefFor(someReference)

//Returns the current ActorContext,
// method only valid within methods of a TypedActor implementation
val c: ActorContext = TypedActor.context

//Returns the external proxy of the current Typed Actor,
// method only valid within methods of a TypedActor implementation
val s: Squarer = TypedActor.self[Squarer]

//Returns a contextual instance of the Typed Actor Extension
//this means that if you create other Typed Actors with this,
//they will become children to the current Typed Actor.
TypedActor(TypedActor.context)
</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L86-L109" target="_blank" title="Go to snippet source"></a><code class="language-java"><br/>// Returns the Typed Actor Extension
TypedActorExtension extension =
    TypedActor.get(system); // system is an instance of ActorSystem

// Returns whether the reference is a Typed Actor Proxy or not
TypedActor.get(system).isTypedActor(someReference);

// Returns the backing Akka Actor behind an external Typed Actor Proxy
TypedActor.get(system).getActorRefFor(someReference);

// Returns the current ActorContext,
// method only valid within methods of a TypedActor implementation
ActorContext context = TypedActor.context();

// Returns the external proxy of the current Typed Actor,
// method only valid within methods of a TypedActor implementation
Squarer sq = TypedActor.&lt;Squarer&gt;self();

// Returns a contextual instance of the Typed Actor Extension
// this means that if you create other Typed Actors with this,
// they will become children to the current Typed Actor.
TypedActor.get(TypedActor.context());
</code></pre></dd>
</dl><div class="callout warning "><div class="callout-title">Warning</div>
<p>Same as not exposing <code>this</code> of an Akka Actor, it&rsquo;s important not to expose <code>this</code> of a Typed Actor, instead you should pass the external proxy reference, which is obtained from within your Typed Actor as <span class="group-scala"><code>TypedActor.self</code></span><span class="group-java"><code>TypedActor.self()</code></span>, this is your external identity, as the <code>ActorRef</code> is the external identity of an Akka Actor.</p></div>
<h2><a href="#creating-typed-actors" name="creating-typed-actors" class="anchor"><span class="anchor-link"></span></a>Creating Typed Actors</h2>
<p>To create a Typed Actor you need to have one or more interfaces, and one implementation.</p>
<p>The following imports are assumed:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L8-L15" target="_blank" title="Go to snippet source"></a><code class="language-scala">import java.lang.String.{ valueOf ⇒ println }

import akka.actor.{ ActorContext, ActorRef, TypedActor, TypedProps }
import akka.routing.RoundRobinGroup
import akka.testkit._

import scala.concurrent.{ Future, Await }
import scala.concurrent.duration._</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L8-L22" target="_blank" title="Go to snippet source"></a><code class="language-java">import akka.actor.TypedActor;
import akka.actor.*;
import akka.japi.*;
import akka.dispatch.Futures;

import jdocs.AbstractJavaTest;
import scala.concurrent.Await;
import scala.concurrent.Future;
import scala.concurrent.duration.Duration;
import java.util.concurrent.TimeUnit;

import java.util.List;
import java.util.ArrayList;
import java.util.Random;
import akka.routing.RoundRobinGroup;</code></pre></dd>
</dl>
<p>Our example interface:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L22-L35" target="_blank" title="Go to snippet source"></a><code class="language-scala">trait Squarer {
  def squareDontCare(i: Int): Unit //fire-forget

  def square(i: Int): Future[Int] //non-blocking send-request-reply

  def squareNowPlease(i: Int): Option[Int] //blocking send-request-reply

  def squareNow(i: Int): Int //blocking send-request-reply

  @throws(classOf[Exception]) //declare it or you will get an UndeclaredThrowableException
  def squareTry(i: Int): Int //blocking send-request-reply with possible exception
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L34-L44" target="_blank" title="Go to snippet source"></a><code class="language-java">static interface Squarer {
  void squareDontCare(int i); // fire-forget

  Future&lt;Integer&gt; square(int i); // non-blocking send-request-reply

  Option&lt;Integer&gt; squareNowPlease(int i); // blocking send-request-reply

  int squareNow(int i); // blocking send-request-reply
}</code></pre></dd>
</dl>
<p>Our example implementation of that interface:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L39-L53" target="_blank" title="Go to snippet source"></a><code class="language-scala">class SquarerImpl(val name: String) extends Squarer {

  def this() = this(&quot;default&quot;)
  def squareDontCare(i: Int): Unit = i * i //Nobody cares :(

  def square(i: Int): Future[Int] = Future.successful(i * i)

  def squareNowPlease(i: Int): Option[Int] = Some(i * i)

  def squareNow(i: Int): Int = i * i

  def squareTry(i: Int): Int = throw new Exception(&quot;Catch me!&quot;)
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L49-L78" target="_blank" title="Go to snippet source"></a><code class="language-java">class SquarerImpl implements Squarer {
  private String name;

  public SquarerImpl() {
    this.name = &quot;default&quot;;
  }

  public SquarerImpl(String name) {
    this.name = name;
  }


  public void squareDontCare(int i) {
    int sq = i * i; // Nobody cares :(
  }

  public Future&lt;Integer&gt; square(int i) {
    return Futures.successful(i * i);
  }

  public Option&lt;Integer&gt; squareNowPlease(int i) {
    return Option.some(i * i);
  }

  public int squareNow(int i) {
    return i * i;
  }
}</code></pre></dd>
</dl>
<p>The most trivial way of creating a Typed Actor instance of our <code>Squarer</code>:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L121-L122" target="_blank" title="Go to snippet source"></a><code class="language-scala">val mySquarer: Squarer =
  TypedActor(system).typedActorOf(TypedProps[SquarerImpl]())</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L120-L122" target="_blank" title="Go to snippet source"></a><code class="language-java">Squarer mySquarer =
    TypedActor.get(system)
        .typedActorOf(new TypedProps&lt;SquarerImpl&gt;(Squarer.class, SquarerImpl.class));</code></pre></dd>
</dl>
<p>First type is the type of the proxy, the second type is the type of the implementation. If you need to call a specific constructor you do it like this:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L125-L128" target="_blank" title="Go to snippet source"></a><code class="language-scala">val otherSquarer: Squarer =
  TypedActor(system).typedActorOf(TypedProps(
    classOf[Squarer],
    new SquarerImpl(&quot;foo&quot;)), &quot;name&quot;)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L125-L135" target="_blank" title="Go to snippet source"></a><code class="language-java">Squarer otherSquarer =
    TypedActor.get(system)
        .typedActorOf(
            new TypedProps&lt;SquarerImpl&gt;(
                Squarer.class,
                new Creator&lt;SquarerImpl&gt;() {
                  public SquarerImpl create() {
                    return new SquarerImpl(&quot;foo&quot;);
                  }
                }),
            &quot;name&quot;);</code></pre></dd>
</dl>
<p>Since you supply a <code>Props</code>, you can specify which dispatcher to use, what the default timeout should be used and more. Now, our <code>Squarer</code> doesn&rsquo;t have any methods, so we&rsquo;d better add those.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L22-L35" target="_blank" title="Go to snippet source"></a><code class="language-scala">trait Squarer {
  def squareDontCare(i: Int): Unit //fire-forget

  def square(i: Int): Future[Int] //non-blocking send-request-reply

  def squareNowPlease(i: Int): Option[Int] //blocking send-request-reply

  def squareNow(i: Int): Int //blocking send-request-reply

  @throws(classOf[Exception]) //declare it or you will get an UndeclaredThrowableException
  def squareTry(i: Int): Int //blocking send-request-reply with possible exception
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L34-L44" target="_blank" title="Go to snippet source"></a><code class="language-java">static interface Squarer {
  void squareDontCare(int i); // fire-forget

  Future&lt;Integer&gt; square(int i); // non-blocking send-request-reply

  Option&lt;Integer&gt; squareNowPlease(int i); // blocking send-request-reply

  int squareNow(int i); // blocking send-request-reply
}</code></pre></dd>
</dl>
<p>Alright, now we&rsquo;ve got some methods we can call, but we need to implement those in <code>SquarerImpl</code>.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L39-L53" target="_blank" title="Go to snippet source"></a><code class="language-scala">class SquarerImpl(val name: String) extends Squarer {

  def this() = this(&quot;default&quot;)
  def squareDontCare(i: Int): Unit = i * i //Nobody cares :(

  def square(i: Int): Future[Int] = Future.successful(i * i)

  def squareNowPlease(i: Int): Option[Int] = Some(i * i)

  def squareNow(i: Int): Int = i * i

  def squareTry(i: Int): Int = throw new Exception(&quot;Catch me!&quot;)
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L49-L78" target="_blank" title="Go to snippet source"></a><code class="language-java">class SquarerImpl implements Squarer {
  private String name;

  public SquarerImpl() {
    this.name = &quot;default&quot;;
  }

  public SquarerImpl(String name) {
    this.name = name;
  }


  public void squareDontCare(int i) {
    int sq = i * i; // Nobody cares :(
  }

  public Future&lt;Integer&gt; square(int i) {
    return Futures.successful(i * i);
  }

  public Option&lt;Integer&gt; squareNowPlease(int i) {
    return Option.some(i * i);
  }

  public int squareNow(int i) {
    return i * i;
  }
}</code></pre></dd>
</dl>
<p>Excellent, now we have an interface and an implementation of that interface, and we know how to create a Typed Actor from that, so let&rsquo;s look at calling these methods.</p>
<h2><a href="#method-dispatch-semantics" name="method-dispatch-semantics" class="anchor"><span class="anchor-link"></span></a>Method dispatch semantics</h2>
<p>Methods returning:</p><div class="group-scala">
<ul>
  <li><code>Unit</code> will be dispatched with <code>fire-and-forget</code> semantics, exactly like <code>ActorRef.tell</code></li>
  <li><code>scala.concurrent.Future[_]</code> will use <code>send-request-reply</code> semantics, exactly like <code>ActorRef.ask</code></li>
  <li><code>scala.Option[_]</code> will use <code>send-request-reply</code> semantics, but <em>will</em> block to wait for an answer, and return <code>scala.None</code> if no answer was produced within the timeout, or <code>scala.Some[_]</code> containing the result otherwise. Any exception that was thrown during this call will be rethrown.</li>
  <li>Any other type of value will use <code>send-request-reply</code> semantics, but <em>will</em> block to wait for an answer, throwing <code>java.util.concurrent.TimeoutException</code> if there was a timeout or rethrow any exception that was thrown during this call.</li>
</ul></div><div class="group-java">
<ul>
  <li><code>void</code> will be dispatched with <code>fire-and-forget</code> semantics, exactly like <code>ActorRef.tell</code></li>
  <li><code>scala.concurrent.Future&lt;?&gt;</code> will use <code>send-request-reply</code> semantics, exactly like <code>ActorRef.ask</code></li>
  <li><code>akka.japi.Option&lt;?&gt;</code> will use <code>send-request-reply</code> semantics, but <em>will</em> block to wait for an answer, and return <code>akka.japi.Option.None</code> if no answer was produced within the timeout, or <code>akka.japi.Option.Some&lt;?&gt;</code> containing the result otherwise. Any exception that was thrown during this call will be rethrown.</li>
  <li>Any other type of value will use <code>send-request-reply</code> semantics, but <em>will</em> block to wait for an answer, throwing <code>java.util.concurrent.TimeoutException</code> if there was a timeout or rethrow any exception that was thrown during this call. Note that due to the Java exception and reflection mechanisms, such a <code>TimeoutException</code> will be wrapped in a <code>java.lang.reflect.UndeclaredThrowableException</code> unless the interface method explicitly declares the <code>TimeoutException</code> as a thrown checked exception.</li>
</ul></div>
<h2><a href="#messages-and-immutability" name="messages-and-immutability" class="anchor"><span class="anchor-link"></span></a>Messages and immutability</h2>
<p>While Akka cannot enforce that the parameters to the methods of your Typed Actors are immutable, we <em>strongly</em> recommend that parameters passed are immutable.</p>
<h3><a href="#one-way-message-send" name="one-way-message-send" class="anchor"><span class="anchor-link"></span></a>One-way message send</h3>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L133" target="_blank" title="Go to snippet source"></a><code class="language-scala">mySquarer.squareDontCare(10)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L140" target="_blank" title="Go to snippet source"></a><code class="language-java">mySquarer.squareDontCare(10);</code></pre></dd>
</dl>
<p>As simple as that! The method will be executed on another thread; asynchronously.</p>
<h3><a href="#request-reply-message-send" name="request-reply-message-send" class="anchor"><span class="anchor-link"></span></a>Request-reply message send</h3>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L141" target="_blank" title="Go to snippet source"></a><code class="language-scala">val oSquare = mySquarer.squareNowPlease(10) //Option[Int]</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L148" target="_blank" title="Go to snippet source"></a><code class="language-java">Option&lt;Integer&gt; oSquare = mySquarer.squareNowPlease(10); // Option[Int]</code></pre></dd>
</dl>
<p>This will block for as long as the timeout that was set in the <code>Props</code> of the Typed Actor, if needed. It will return <code>None</code> if a timeout occurs.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L145" target="_blank" title="Go to snippet source"></a><code class="language-scala">val iSquare = mySquarer.squareNow(10) //Int</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L152" target="_blank" title="Go to snippet source"></a><code class="language-java">int iSquare = mySquarer.squareNow(10); // Int</code></pre></dd>
</dl>
<p>This will block for as long as the timeout that was set in the <code>Props</code> of the Typed Actor, if needed. It will throw a <code>java.util.concurrent.TimeoutException</code> if a timeout occurs.</p><div class="group-java">
<p>Note that here, such a <code>TimeoutException</code> will be wrapped in a <code>java.lang.reflect.UndeclaredThrowableException</code> by the Java reflection mechanism, because the interface method does not explicitly declare the <code>TimeoutException</code> as a thrown checked exception. To get the <code>TimeoutException</code> directly, declare <code>throws java.util.concurrent.TimeoutException</code> at the interface method.</p></div>
<h3><a href="#request-reply-with-future-message-send" name="request-reply-with-future-message-send" class="anchor"><span class="anchor-link"></span></a>Request-reply-with-future message send</h3>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L137" target="_blank" title="Go to snippet source"></a><code class="language-scala">val fSquare = mySquarer.square(10) //A Future[Int]</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L144" target="_blank" title="Go to snippet source"></a><code class="language-java">Future&lt;Integer&gt; fSquare = mySquarer.square(10); // A Future[Int]</code></pre></dd>
</dl>
<p>This call is asynchronous, and the Future returned can be used for asynchronous composition.</p>
<h2><a href="#stopping-typed-actors" name="stopping-typed-actors" class="anchor"><span class="anchor-link"></span></a>Stopping Typed Actors</h2>
<p>Since Akka&rsquo;s Typed Actors are backed by Akka Actors they must be stopped when they aren&rsquo;t needed anymore.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L156" target="_blank" title="Go to snippet source"></a><code class="language-scala">TypedActor(system).stop(mySquarer)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L163" target="_blank" title="Go to snippet source"></a><code class="language-java">TypedActor.get(system).stop(mySquarer);</code></pre></dd>
</dl>
<p>This asynchronously stops the Typed Actor associated with the specified proxy ASAP.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L160" target="_blank" title="Go to snippet source"></a><code class="language-scala">TypedActor(system).poisonPill(otherSquarer)</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L167" target="_blank" title="Go to snippet source"></a><code class="language-java">TypedActor.get(system).poisonPill(otherSquarer);</code></pre></dd>
</dl>
<p>This asynchronously stops the Typed Actor associated with the specified proxy after it&rsquo;s done with all calls that were made prior to this call.</p>
<h2><a href="#typed-actor-hierarchies" name="typed-actor-hierarchies" class="anchor"><span class="anchor-link"></span></a>Typed Actor Hierarchies</h2>
<p>Since you can obtain a contextual Typed Actor Extension by passing in an <code>ActorContext</code> you can create child Typed Actors by invoking <code>typedActorOf(..)</code> on that.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L179-L182" target="_blank" title="Go to snippet source"></a><code class="language-scala">//Inside your Typed Actor
val childSquarer: Squarer =
  TypedActor(TypedActor.context).typedActorOf(TypedProps[SquarerImpl]())
//Use &quot;childSquarer&quot; as a Squarer</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L178-L181" target="_blank" title="Go to snippet source"></a><code class="language-java">Squarer childSquarer =
    TypedActor.get(TypedActor.context())
        .typedActorOf(new TypedProps&lt;SquarerImpl&gt;(Squarer.class, SquarerImpl.class));
// Use &quot;childSquarer&quot; as a Squarer</code></pre></dd>
</dl>
<p>You can also create a child Typed Actor in regular Akka Actors by giving the <span class="group-scala"><code>ActorContext</code></span><span class="group-java"><code>AbstractActor.ActorContext</code></span> as an input parameter to <code>TypedActor.get(…)</code>.</p>
<h2><a href="#supervisor-strategy" name="supervisor-strategy" class="anchor"><span class="anchor-link"></span></a>Supervisor Strategy</h2>
<p>By having your Typed Actor implementation class implement <code>TypedActor.Supervisor</code> you can define the strategy to use for supervising child actors, as described in <a href="general/supervision.html">supervision</a> and <a href="fault-tolerance.html">Fault Tolerance</a>.</p>
<h2><a href="#lifecycle-callbacks" name="lifecycle-callbacks" class="anchor"><span class="anchor-link"></span></a>Lifecycle callbacks</h2>
<p>By having your Typed Actor implementation class implement any and all of the following:</p>
<ul>
  <li><code>TypedActor.PreStart</code></li>
  <li><code>TypedActor.PostStop</code></li>
  <li><code>TypedActor.PreRestart</code></li>
  <li><code>TypedActor.PostRestart</code></li>
</ul>
<p>You can hook into the lifecycle of your Typed Actor.</p>
<h2><a href="#receive-arbitrary-messages" name="receive-arbitrary-messages" class="anchor"><span class="anchor-link"></span></a>Receive arbitrary messages</h2>
<p>If your implementation class of your TypedActor extends <code>akka.actor.TypedActor.Receiver</code>, all messages that are not <code>MethodCall</code> instances will be passed into the <code>onReceive</code>-method.</p>
<p>This allows you to react to DeathWatch <code>Terminated</code>-messages and other types of messages, e.g. when interfacing with untyped actors.</p>
<h2><a href="#proxying" name="proxying" class="anchor"><span class="anchor-link"></span></a>Proxying</h2>
<p>You can use the <code>typedActorOf</code> that takes a TypedProps and an ActorRef to proxy the given ActorRef as a TypedActor. This is usable if you want to communicate remotely with TypedActors on other machines, pass the <code>ActorRef</code> to <code>typedActorOf</code>.</p><div class="callout note "><div class="callout-title">Note</div>
<p>The ActorRef needs to accept <code>MethodCall</code> messages.</p></div>
<h2><a href="#lookup-remoting" name="lookup-remoting" class="anchor"><span class="anchor-link"></span></a>Lookup &amp; Remoting</h2>
<p>Since <code>TypedActors</code> are backed by <code>Akka Actors</code>, you can use <code>typedActorOf</code> to proxy <code>ActorRefs</code> potentially residing on remote nodes.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L167-L172" target="_blank" title="Go to snippet source"></a><code class="language-scala">val typedActor: Foo with Bar =
  TypedActor(system).
    typedActorOf(
      TypedProps[FooBar],
      actorRefToRemoteActor)
//Use &quot;typedActor&quot; as a FooBar</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L193-L196" target="_blank" title="Go to snippet source"></a><code class="language-java">Squarer typedActor =
    TypedActor.get(system)
        .typedActorOf(new TypedProps&lt;Squarer&gt;(Squarer.class), actorRefToRemoteActor);
// Use &quot;typedActor&quot; as a FooBar</code></pre></dd>
</dl><div class="group-scala">
<h2><a href="#supercharging" name="supercharging" class="anchor"><span class="anchor-link"></span></a>Supercharging</h2>
<p>Here&rsquo;s an example on how you can use traits to mix in behavior in your Typed Actors.</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L56-L65" target="_blank" title="Go to snippet source"></a><code class="language-scala">trait Foo {
  def doFoo(times: Int): Unit = println(&quot;doFoo(&quot; + times + &quot;)&quot;)
}

trait Bar {
  def doBar(str: String): Future[String] =
    Future.successful(str.toUpperCase)
}

class FooBar extends Foo with Bar</code></pre>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L191-L197" target="_blank" title="Go to snippet source"></a><code class="language-scala">val awesomeFooBar: Foo with Bar =
  TypedActor(system).typedActorOf(TypedProps[FooBar]())

awesomeFooBar.doFoo(10)
val f = awesomeFooBar.doBar(&quot;yes&quot;)

TypedActor(system).poisonPill(awesomeFooBar)</code></pre></div>
<h2><a href="#typed-router-pattern" name="typed-router-pattern" class="anchor"><span class="anchor-link"></span></a>Typed Router pattern</h2>
<p>Sometimes you want to spread messages between multiple actors. The easiest way to achieve this in Akka is to use a <a href="routing.html">Router</a>, which can implement a specific routing logic, such as <code>smallest-mailbox</code> or <code>consistent-hashing</code> etc.</p>
<p>Routers are not provided directly for typed actors, but it is really easy to leverage an untyped router and use a typed proxy in front of it. To showcase this let&rsquo;s create typed actors that assign themselves some random <code>id</code>, so we know that in fact, the router has sent the message to different actors:</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L69-L78" target="_blank" title="Go to snippet source"></a><code class="language-scala">trait HasName {
  def name(): String
}

class Named extends HasName {
  import scala.util.Random
  private val id = Random.nextInt(1024)

  def name(): String = &quot;name-&quot; + id
}</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L204-L215" target="_blank" title="Go to snippet source"></a><code class="language-java">interface HasName {
  String name();
}

class Named implements HasName {
  private int id = new Random().nextInt(1024);

  @Override
  public String name() {
    return &quot;name-&quot; + id;
  }
}</code></pre></dd>
</dl>
<p>In order to round robin among a few instances of such actors, you can create a plain untyped router, and then facade it with a <code>TypedActor</code> like shown in the example below. This works because typed actors communicate using the same mechanisms as normal actors, and methods calls on them get transformed into message sends of <code>MethodCall</code> messages.</p>
<dl>
  <dt>Scala</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/scala/docs/actor/TypedActorDocSpec.scala#L204-L222" target="_blank" title="Go to snippet source"></a><code class="language-scala">def namedActor(): HasName = TypedActor(system).typedActorOf(TypedProps[Named]())

// prepare routees
val routees: List[HasName] = List.fill(5) { namedActor() }
val routeePaths = routees map { r ⇒
  TypedActor(system).getActorRefFor(r).path.toStringWithoutAddress
}

// prepare untyped router
val router: ActorRef = system.actorOf(RoundRobinGroup(routeePaths).props())

// prepare typed proxy, forwarding MethodCall messages to `router`
val typedRouter: HasName =
  TypedActor(system).typedActorOf(TypedProps[Named](), actorRef = router)

println(&quot;actor was: &quot; + typedRouter.name()) // name-184
println(&quot;actor was: &quot; + typedRouter.name()) // name-753
println(&quot;actor was: &quot; + typedRouter.name()) // name-320
println(&quot;actor was: &quot; + typedRouter.name()) // name-164</code></pre></dd>
  <dt>Java</dt>
  <dd>
  <pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/xmeng1/akka/tree/master/akka-docs/src/test/java/jdocs/actor/TypedActorDocTest.java#L222-L247" target="_blank" title="Go to snippet source"></a><code class="language-java">// prepare routees
TypedActorExtension typed = TypedActor.get(system);

Named named1 = typed.typedActorOf(new TypedProps&lt;Named&gt;(Named.class));

Named named2 = typed.typedActorOf(new TypedProps&lt;Named&gt;(Named.class));

List&lt;Named&gt; routees = new ArrayList&lt;Named&gt;();
routees.add(named1);
routees.add(named2);

List&lt;String&gt; routeePaths = new ArrayList&lt;String&gt;();
routeePaths.add(typed.getActorRefFor(named1).path().toStringWithoutAddress());
routeePaths.add(typed.getActorRefFor(named2).path().toStringWithoutAddress());

// prepare untyped router
ActorRef router = system.actorOf(new RoundRobinGroup(routeePaths).props(), &quot;router&quot;);

// prepare typed proxy, forwarding MethodCall messages to `router`
Named typedRouter = typed.typedActorOf(new TypedProps&lt;Named&gt;(Named.class), router);

System.out.println(&quot;actor was: &quot; + typedRouter.name()); // name-243
System.out.println(&quot;actor was: &quot; + typedRouter.name()); // name-614
System.out.println(&quot;actor was: &quot; + typedRouter.name()); // name-243
System.out.println(&quot;actor was: &quot; + typedRouter.name()); // name-614
</code></pre></dd>
</dl>
</div>
</article>

<div class="row">
<div class="small-12 large-9 column">
<section class="nav-prev-next row">
<div class="nav-prev small-6 column">
</div>
<div class="nav-next small-6 column clearfix">
</div>
</section>
</div>
</div>

<div class="source-github row">
Found an error in this documentation? The source code for this page can be found <a href="https://github.com/xmeng1/akka/tree/master/akka-docs-cn/src/main/paradox/typed-actors.md">here</a>.
Please feel free to edit and contribute a pull request.
</div>


<footer class="page-footer row clearfix">
<img class="akka-icon float-left show-for-medium" src="images/akka-icon.svg">
<section class="copyright">
<div>Akka is Open Source and available under the Apache 2 License.</div>
<p class="legal">
&copy; 2011-2019 <a href="https://www.lightbend.com" target="_blank">Lightbend, Inc.</a> | 
<a href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> | 
<a href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> | 
<a href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> | 
<a href="https://akka.io/cookie/" target="_blank">Cookie Listing</a> | 
<a class="optanon-toggle-display">Cookie Settings</a>
</p>
</section>
</footer>

</section>
</main>

<script type="text/javascript" src="js/scrollsneak.js"></script>
<script type="text/javascript">jQuery(document).foundation();</script>
<script type="text/javascript" src="js/groups.js"></script>
<script type="text/javascript" src="js/page.js"></script>
<script type="text/javascript" src="js/magellan.js"></script>

<style type="text/css">@import "lib/prettify/prettify.css";</style>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">jQuery(function(){window.prettyPrint && prettyPrint()});</script>

<!-- Algolia docs search -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<style>.algolia-autocomplete { display: block !important }</style>
<script type="text/javascript">
docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#search',
algoliaOptions: {
hitsPerPage: 5
}
});

docsearch({
apiKey: '543bad5ad786495d9ccd445ed34ed082',
indexName: 'akka_io',
inputSelector: '#overlay-search',
algoliaOptions: {
hitsPerPage: 5
}
});

// set up "/" as global shortcut for focusing on search
jQuery(document).keypress(function (event) {
if (event.keyCode == 47) {
jQuery("#search").focus();
return false; // swallow key event, otherwise the / char would be input into the search box
}
});
</script>

<script type="text/javascript" src="assets/js/warnOldDocs.js"></script>
<script type="text/javascript" src="assets/js/scalafiddle.js"></script>


</body>
</html>
